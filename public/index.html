<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ploymédication Online - Jeu de Pharmacologie Multijoueur</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #ec4899;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1f2937;
            --light: #f9fafb;
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            overflow-x: hidden;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .screen {
            min-height: 100vh;
            padding: 20px;
        }

        .screen.active {
            display: flex;
            flex-direction: column;
        }



        .btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            width: 100%;
            margin: 10px 0;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #6b7280, #4b5563);
        }

        .btn.secondary:hover {
            box-shadow: 0 10px 30px rgba(107, 114, 128, 0.4);
        }

        .auth-title {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .auth-subtitle {
            color: #6b7280;
            font-size: 1.1rem;
            margin-bottom: 30px;
            font-weight: 500;
        }

        /* Écran de lobby */
        .lobby-container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
        }

        .lobby-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid var(--glass-border);
        }

        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            font-weight: bold;
        }

        .user-details h3 {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .user-status {
            color: var(--success);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .lobby-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .option-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border: 1px solid var(--glass-border);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .option-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(236, 72, 153, 0.05));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .option-card:hover::before {
            opacity: 1;
        }

        .option-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }

        .option-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
        }

        .option-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .option-description {
            color: #6b7280;
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        /* Modal de création de partie */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            border: 1px solid var(--glass-border);
            position: relative;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6b7280;
            transition: color 0.3s ease;
        }

        .close-btn:hover {
            color: var(--danger);
        }

        .game-code {
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            border: 2px dashed var(--primary);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
        }

        .code-display {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
            letter-spacing: 4px;
            margin-bottom: 10px;
            font-family: 'Courier New', monospace;
        }

        .code-instruction {
            color: #6b7280;
            font-size: 0.9rem;
        }

        /* Écran de jeu amélioré */
        .game-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .game-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px 30px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid var(--glass-border);
        }

        .game-title-small {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .game-status {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .game-main {
            display: grid;
            grid-template-columns: 320px 1fr 320px;
            gap: 20px;
            flex: 1;
            align-items: start;
        }

        .sidebar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border: 1px solid var(--glass-border);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .board-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid var(--glass-border);
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(6, 1fr);
            gap: 4px;
            background: linear-gradient(135deg, #1f2937, #374151);
            padding: 20px;
            border-radius: 20px;
            margin: 20px 0;
            box-shadow: inset 0 4px 12px rgba(0,0,0,0.3);
            position: relative;
        }

        .game-board::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 49%, rgba(255,255,255,0.1) 50%, transparent 51%);
            pointer-events: none;
        }

        .cell {
            background: #f8fafc;
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: 600;
            position: relative;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            min-height: 80px;
            border: 3px solid transparent;
            overflow: hidden;
        }

        .cell::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.2), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .cell:hover::after {
            transform: translateX(100%);
        }

        .cell:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 12px 30px rgba(0,0,0,0.2);
        }

        .cell-emoji {
            font-size: 2rem;
            margin-bottom: 4px;
            filter: drop-shadow(0 3px 6px rgba(0,0,0,0.2));
        }

        .cell-number {
            font-size: 0.7rem;
            opacity: 0.8;
            font-weight: 500;
            background: rgba(0,0,0,0.1);
            padding: 2px 6px;
            border-radius: 8px;
        }

        .cell.safe {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border-color: #059669;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }

        .cell.virus {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border-color: #dc2626;
            animation: pulse-danger 3s infinite;
        }

        .cell.bacteria {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            border-color: #d97706;
            animation: pulse-warning 3s infinite;
        }

        .cell.fungus {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            border-color: #7c3aed;
            animation: pulse-purple 3s infinite;
        }

        .cell.parasite {
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: white;
            border-color: #ea580c;
            animation: pulse-orange 3s infinite;
        }

        .cell.hypertension {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
            border-color: #b91c1c;
            animation: pulse-red 3s infinite;
        }

        .cell.diabetes {
            background: linear-gradient(135deg, #059669, #047857);
            color: white;
            border-color: #047857;
            animation: pulse-green 3s infinite;
        }

        .cell.start {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border-color: #2563eb;
            box-shadow: 0 0 25px rgba(59, 130, 246, 0.5);
        }

        .cell.finish {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            border-color: #f59e0b;
            box-shadow: 0 0 25px rgba(251, 191, 36, 0.5);
            animation: glow-gold 2s infinite;
        }

        .cell.bonus {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            border-color: #f59e0b;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.4);
            animation: pulse-bonus 2s infinite;
        }

        .cell.challenge {
            background: linear-gradient(135deg, #ec4899, #db2777);
            color: white;
            border-color: #db2777;
            box-shadow: 0 0 20px rgba(236, 72, 153, 0.4);
            animation: pulse-challenge 2s infinite;
        }

        @keyframes pulse-danger { 0%, 100% { box-shadow: 0 0 15px rgba(239, 68, 68, 0.4); } 50% { box-shadow: 0 0 30px rgba(239, 68, 68, 0.8); } }
        @keyframes pulse-warning { 0%, 100% { box-shadow: 0 0 15px rgba(245, 158, 11, 0.4); } 50% { box-shadow: 0 0 30px rgba(245, 158, 11, 0.8); } }
        @keyframes pulse-purple { 0%, 100% { box-shadow: 0 0 15px rgba(139, 92, 246, 0.4); } 50% { box-shadow: 0 0 30px rgba(139, 92, 246, 0.8); } }
        @keyframes pulse-orange { 0%, 100% { box-shadow: 0 0 15px rgba(249, 115, 22, 0.4); } 50% { box-shadow: 0 0 30px rgba(249, 115, 22, 0.8); } }
        @keyframes pulse-red { 0%, 100% { box-shadow: 0 0 15px rgba(220, 38, 38, 0.4); } 50% { box-shadow: 0 0 30px rgba(220, 38, 38, 0.8); } }
        @keyframes pulse-green { 0%, 100% { box-shadow: 0 0 15px rgba(5, 150, 105, 0.4); } 50% { box-shadow: 0 0 30px rgba(5, 150, 105, 0.8); } }
        @keyframes glow-gold { 0%, 100% { box-shadow: 0 0 20px rgba(251, 191, 36, 0.6); } 50% { box-shadow: 0 0 40px rgba(251, 191, 36, 0.9); } }
        @keyframes pulse-bonus { 0%, 100% { box-shadow: 0 0 15px rgba(251, 191, 36, 0.4); transform: scale(1); } 50% { box-shadow: 0 0 30px rgba(251, 191, 36, 0.8); transform: scale(1.05); } }
        @keyframes pulse-challenge { 0%, 100% { box-shadow: 0 0 15px rgba(236, 72, 153, 0.4); transform: rotate(0deg); } 50% { box-shadow: 0 0 30px rgba(236, 72, 153, 0.8); transform: rotate(5deg); } }

        .player {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            position: absolute;
            border: 4px solid white;
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 10;
        }

        .player1 {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            top: 8px;
            left: 8px;
        }

        .player2 {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            top: 8px;
            right: 8px;
        }

        .player.moving {
            animation: playerMove 0.6s ease-in-out;
        }

        @keyframes playerMove {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2) translateY(-10px); }
        }

        .player-info {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 20px;
            border: 3px solid transparent;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .player-info::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transform: scaleX(0);
            transition: transform 0.4s ease;
        }

        .player-info.active {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            border-color: var(--primary);
            transform: scale(1.03);
            box-shadow: 0 15px 40px rgba(59, 130, 246, 0.2);
        }

        .player-info.active::before {
            transform: scaleX(1);
        }

        .player-avatar-large {
            font-size: 3.5rem;
            margin-bottom: 15px;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
        }

        .player-name {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 15px;
        }

        .player-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.8rem;
            color: #6b7280;
            margin-top: 5px;
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e5e7eb;
            border-radius: 6px;
            overflow: hidden;
            margin: 15px 0;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 6px;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: progressShine 2s infinite;
        }

        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .dice-container {
            text-align: center;
            margin: 30px 0;
            padding: 30px;
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border-radius: 20px;
            border: 3px solid rgba(0,0,0,0.05);
        }

        .dice {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #ffffff, #f1f5f9);
            border: 4px solid var(--dark);
            border-radius: 24px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: bold;
            color: var(--dark);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
        }

        .dice::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .dice:hover::before {
            opacity: 1;
        }

        .dice:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 20px 50px rgba(99, 102, 241, 0.4);
        }

        .dice span {
            position: relative;
            z-index: 2;
            transition: color 0.3s ease;
        }

        .dice:hover span {
            color: white;
        }

        .dice.rolling {
            animation: diceRoll 1.5s ease-in-out;
        }

        @keyframes diceRoll {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(90deg) scale(1.2); }
            50% { transform: rotate(180deg) scale(1.3); }
            75% { transform: rotate(270deg) scale(1.2); }
            100% { transform: rotate(360deg) scale(1); }
        }

        .current-turn {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark);
            margin-top: 15px;
        }

        .defense-cards {
            margin-top: 25px;
        }

        .cards-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 25px;
            text-align: center;
        }

        .defense-card {
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            padding: 25px;
            margin: 15px 0;
            border-radius: 18px;
            border: 3px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .defense-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(236, 72, 153, 0.05));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .defense-card:hover::before {
            opacity: 1;
        }

        .defense-card:hover {
            border-color: var(--primary);
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 15px 40px rgba(99, 102, 241, 0.2);
        }

        .defense-card.selected {
            border-color: var(--success);
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 15px 40px rgba(16, 185, 129, 0.3);
        }

        .card-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            filter: drop-shadow(0 3px 6px rgba(0,0,0,0.1));
        }

        .card-name {
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 10px;
            font-size: 1.1rem;
            position: relative;
            z-index: 2;
        }

        .card-description {
            font-size: 0.9rem;
            color: #6b7280;
            position: relative;
            z-index: 2;
            line-height: 1.4;
        }

        .action-buttons {
            margin-top: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .btn-game {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 18px 25px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 700;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-game::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn-game:hover::before {
            left: 100%;
        }

        .btn-game:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(99, 102, 241, 0.4);
        }

        .btn-game:disabled {
            background: linear-gradient(135deg, #9ca3af, #6b7280);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-game.danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
        }

        .btn-game.danger:hover {
            box-shadow: 0 12px 35px rgba(239, 68, 68, 0.4);
        }

        .btn-game.success {
            background: linear-gradient(135deg, var(--success), #059669);
        }

        .btn-game.success:hover {
            box-shadow: 0 12px 35px rgba(16, 185, 129, 0.4);
        }

        .message {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border: 3px solid #f59e0b;
            color: #92400e;
            padding: 25px;
            border-radius: 18px;
            margin: 30px 0;
            text-align: center;
            font-weight: 600;
            font-size: 1.1rem;
            box-shadow: 0 10px 30px rgba(245, 158, 11, 0.2);
            animation: messageSlide 0.6s ease-out;
        }

        .message.success {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            border-color: var(--success);
            color: #065f46;
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.2);
        }

        .message.danger {
            background: linear-gradient(135deg, #fee2e2, #fecaca);
            border-color: var(--danger);
            color: #991b1b;
            box-shadow: 0 10px 30px rgba(239, 68, 68, 0.2);
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .game-legend {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border-radius: 18px;
            border: 3px solid rgba(0,0,0,0.05);
        }

        .legend-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 20px;
            text-align: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 12px 0;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .legend-icon {
            font-size: 1.4rem;
            margin-right: 12px;
            width: 30px;
            text-align: center;
        }

        /* Responsive Design */
        @media (max-width: 1400px) {
            .game-main {
                grid-template-columns: 280px 1fr 280px;
                gap: 15px;
            }
        }

        @media (max-width: 1200px) {
            .game-main {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .sidebar {
                position: static;
            }
        }

        @media (max-width: 768px) {
            body {
                font-size: 16px;
            }
            
            .game-container, .lobby-container {
                padding: 8px;
            }
            
            .auth-container {
                padding: 25px 15px;
                margin: 10px;
            }
            
            .auth-title {
                font-size: 1.8rem;
            }
            
            .auth-subtitle {
                font-size: 1rem;
            }
            
            .logo {
                font-size: 3rem;
            }
            
            .game-header {
                padding: 15px 20px;
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .game-title-small {
                font-size: 1.2rem;
            }
            
            .game-status {
                flex-direction: column;
                gap: 10px;
            }
            
            .board-container {
                padding: 15px;
                margin: 0;
            }
            
            .game-board {
                grid-template-columns: repeat(10, 1fr);
                gap: 3px;
                padding: 12px;
                margin: 15px 0;
            }
            
            .cell {
                min-height: 45px;
                font-size: 0.7rem;
                border-radius: 8px;
                padding: 2px;
            }
            
            .cell-emoji {
                font-size: 1.2rem;
                margin-bottom: 2px;
            }
            
            .cell-number {
                font-size: 0.6rem;
                padding: 1px 3px;
            }
            
            .player {
                width: 18px;
                height: 18px;
                border-width: 2px;
                top: 4px;
            }
            
            .player1 {
                left: 4px;
            }
            
            .player2 {
                right: 4px;
            }
            
            .sidebar {
                padding: 15px;
                margin: 0;
            }
            
            .player-info {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .player-avatar-large {
                font-size: 2.5rem;
                margin-bottom: 10px;
            }
            
            .player-name {
                font-size: 1.1rem;
                margin-bottom: 10px;
            }
            
            .player-stats {
                gap: 10px;
                margin: 15px 0;
            }
            
            .stat-item {
                padding: 10px;
            }
            
            .stat-value {
                font-size: 1.4rem;
            }
            
            .stat-label {
                font-size: 0.7rem;
            }
            
            .dice-container {
                padding: 20px;
                margin: 20px 0;
            }
            
            .dice {
                width: 80px;
                height: 80px;
                font-size: 2rem;
                margin-bottom: 15px;
            }
            
            .current-turn {
                font-size: 1rem;
            }
            
            .defense-cards {
                margin-top: 20px;
            }
            
            .cards-title {
                font-size: 1.2rem;
                margin-bottom: 15px;
            }
            
            .defense-card {
                padding: 15px;
                margin: 10px 0;
                border-radius: 12px;
            }
            
            .card-icon {
                font-size: 2rem;
                margin-bottom: 10px;
            }
            
            .card-name {
                font-size: 1rem;
                margin-bottom: 8px;
            }
            
            .card-description {
                font-size: 0.8rem;
            }
            
            .action-buttons {
                margin-top: 20px;
                gap: 10px;
            }
            
            .btn-game {
                padding: 14px 20px;
                font-size: 0.9rem;
            }
            
            .game-legend {
                margin-top: 20px;
                padding: 15px;
            }
            
            .legend-title {
                font-size: 1rem;
                margin-bottom: 15px;
            }
            
            .legend-item {
                margin: 8px 0;
                font-size: 0.85rem;
            }
            
            .legend-icon {
                font-size: 1.2rem;
                margin-right: 8px;
                width: 25px;
            }
            
            .message {
                padding: 15px;
                margin: 15px 0;
                font-size: 0.95rem;
                border-radius: 12px;
            }
            
            .lobby-options {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .option-card {
                padding: 25px 20px;
            }
            
            .option-icon {
                font-size: 2.5rem;
            }
            
            .option-title {
                font-size: 1.3rem;
            }
            
            .option-description {
                font-size: 0.9rem;
            }
            
            .modal-content {
                padding: 25px 20px;
                margin: 20px;
            }
            
            .modal-title {
                font-size: 1.5rem;
            }
            
            .code-display {
                font-size: 1.5rem;
                letter-spacing: 2px;
            }
        }

        @media (max-width: 480px) {
            .auth-container {
                padding: 20px 12px;
                margin: 5px;
            }
            
            .auth-title {
                font-size: 1.6rem;
            }
            
            .logo {
                font-size: 2.5rem;
            }
            
            .game-board {
                grid-template-columns: repeat(10, 1fr);
                gap: 2px;
                padding: 8px;
            }
            
            .cell {
                min-height: 35px;
                font-size: 0.6rem;
                border-radius: 6px;
            }
            
            .cell-emoji {
                font-size: 1rem;
            }
            
            .cell-number {
                font-size: 0.5rem;
            }
            
            .player {
                width: 14px;
                height: 14px;
                top: 2px;
            }
            
            .player1 {
                left: 2px;
            }
            
            .player2 {
                right: 2px;
            }
            
            .dice {
                width: 70px;
                height: 70px;
                font-size: 1.8rem;
            }
            
            .sidebar {
                padding: 12px;
            }
            
            .defense-card {
                padding: 12px;
            }
            
            .card-icon {
                font-size: 1.8rem;
            }
            
            .btn-game {
                padding: 12px 16px;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>


    <!-- Écran de jeu -->
    <div class="screen active" id="gameScreen">
        <div class="game-container">
            <div class="game-header">
                <div class="game-title-small">🏥 Ploymédication Online</div>
                <div class="game-status">
                    <div class="status-item">
                        <div class="status-indicator"></div>
                        <span>Partie en cours</span>
                    </div>
                    <div class="status-item">
                        <span>Tour: <strong id="turnCounter">1</strong></span>
                    </div>
                </div>
            </div>

            <div class="game-main">
                <!-- Sidebar gauche - Joueurs -->
                <div class="sidebar">
                    <div class="player-info" id="player1Info">
                        <div class="player-avatar-large">👨‍⚕️</div>
                        <div class="player-name" id="player1Name">Dr. Alpha</div>
                        <div class="player-stats">
                            <div class="stat-item">
                                <div class="stat-value" id="player1Pos">0</div>
                                <div class="stat-label">Position</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="player1Score">0</div>
                                <div class="stat-label">Score</div>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="player1Progress" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="player-info" id="player2Info">
                        <div class="player-avatar-large">👩‍⚕️</div>
                        <div class="player-name" id="player2Name">Dr. Beta</div>
                        <div class="player-stats">
                            <div class="stat-item">
                                <div class="stat-value" id="player2Pos">0</div>
                                <div class="stat-label">Position</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="player2Score">0</div>
                                <div class="stat-label">Score</div>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="player2Progress" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="dice-container">
                        <div class="dice" id="dice" onclick="rollDice()">
                            <span>🎲</span>
                        </div>
                        <div class="current-turn">
                            Tour de: <span id="currentPlayer">Dr. Alpha</span>
                        </div>
                    </div>
                </div>

                <!-- Zone centrale - Plateau -->
                <div class="board-container">
                    <div class="game-board" id="gameBoard"></div>
                    <div id="message" class="message" style="display: none;"></div>
                </div>

                <!-- Sidebar droite - Cartes et actions -->
                <div class="sidebar">
                    <div class="defense-cards">
                        <h3 class="cards-title">🛡️ Arsenal Médical</h3>
                        
                        <div class="defense-card" data-type="virus" onclick="selectCard('antiviral')">
                            <div class="card-icon">💊</div>
                            <div class="card-name">Antiviraux</div>
                            <div class="card-description">Neutralise efficacement les virus pathogènes</div>
                        </div>
                        
                        <div class="defense-card" data-type="bacteria" onclick="selectCard('antibiotic')">
                            <div class="card-icon">💉</div>
                            <div class="card-name">Antibiotiques</div>
                            <div class="card-description">Élimine les bactéries infectieuses</div>
                        </div>
                        
                        <div class="defense-card" data-type="fungus" onclick="selectCard('antifungal')">
                            <div class="card-icon">🧪</div>
                            <div class="card-name">Antifongiques</div>
                            <div class="card-description">Combat les infections fongiques</div>
                        </div>
                        
                        <div class="defense-card" data-type="parasite" onclick="selectCard('antiparasitic')">
                            <div class="card-icon">⚗️</div>
                            <div class="card-name">Antiparasitaires</div>
                            <div class="card-description">Détruit les parasites nuisibles</div>
                        </div>
                        
                        <div class="defense-card" data-type="hypertension" onclick="selectCard('antihypertensive')">
                            <div class="card-icon">💗</div>
                            <div class="card-name">Antihypertenseurs</div>
                            <div class="card-description">Régule la pression artérielle élevée</div>
                        </div>
                        
                        <div class="defense-card" data-type="diabetes" onclick="selectCard('antidiabetic')">
                            <div class="card-icon">🩺</div>
                            <div class="card-name">Antidiabétiques</div>
                            <div class="card-description">Contrôle la glycémie et le diabète</div>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn-game success" onclick="useDefenseCard()" id="useCardBtn" disabled>
                            🛡️ Utiliser Traitement
                        </button>
                        <button class="btn-game danger" onclick="skipTurn()" id="skipBtn" disabled>
                            ❓ Ne Sait Pas
                        </button>
                        <button class="btn-game" onclick="resetGame()">
                            🔄 Nouvelle Partie
                        </button>
                    </div>

                    <div class="game-legend">
                        <div class="legend-title">📋 Guide du Jeu</div>
                        <div class="legend-item">
                            <span class="legend-icon">🦠</span>
                            <span>Virus - Antiviraux requis</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-icon">🧫</span>
                            <span>Bactérie - Antibiotiques requis</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-icon">🍄</span>
                            <span>Champignon - Antifongiques requis</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-icon">🐛</span>
                            <span>Parasite - Antiparasitaires requis</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-icon">💓</span>
                            <span>Hypertension - Antihypertenseurs requis</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-icon">🍯</span>
                            <span>Diabète - Antidiabétiques requis</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-icon">✅</span>
                            <span>Zone sûre - Aucun danger</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-icon">⭐</span>
                            <span>Bonus - Points + Relance</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-icon">🎯</span>
                            <span>Défi - Question médicale</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // État global de l'application
        let appState = {
            currentScreen: 'lobbyScreen',
            currentUser: { username: 'Joueur', avatar: '👨‍⚕️' },
            gameSession: null,
            isOnline: false
        };

        // État du jeu
        let gameState = {
            currentPlayer: 1,
            players: {
                1: { 
                    position: 0, 
                    needsDefense: false, 
                    threatType: null,
                    name: "Dr. Alpha",
                    avatar: "👨‍⚕️",
                    score: 0,
                    isOnline: true
                },
                2: { 
                    position: 0, 
                    needsDefense: false, 
                    threatType: null,
                    name: "Dr. Beta",
                    avatar: "👩‍⚕️",
                    score: 0,
                    isOnline: false
                }
            },
            selectedCard: null,
            diceValue: 0,
            gameEnded: false,
            totalCells: 60,
            gameCode: null,
            turnNumber: 1
        };

        // Configuration du plateau - Version 6 (60 carreaux)
        const boardConfig = [
            'start', 'safe', 'virus', 'safe', 'bacteria', 'safe', 'fungus', 'safe', 'parasite', 'bonus',
            'hypertension', 'safe', 'diabetes', 'safe', 'virus', 'challenge', 'bacteria', 'safe', 'fungus', 'safe',
            'parasite', 'safe', 'hypertension', 'bonus', 'diabetes', 'safe', 'virus', 'safe', 'bacteria', 'challenge',
            'fungus', 'safe', 'parasite', 'safe', 'hypertension', 'safe', 'diabetes', 'bonus', 'virus', 'safe',
            'bacteria', 'safe', 'fungus', 'challenge', 'parasite', 'safe', 'hypertension', 'safe', 'diabetes', 'safe',
            'virus', 'bonus', 'bacteria', 'safe', 'fungus', 'safe', 'parasite', 'challenge', 'safe', 'finish'
        ];

        // Nouvelles règles - Version 6
        const gameRules = {
            unlimitedCards: true, // Cartes de défense illimitées
            penaltyForWrongTreatment: 2, // Recul de 2 cases pour mauvais traitement
            skipTurnOnly: true // Passer le tour seulement, sans recul ni pénalité
        };

        const pathogenData = {
            virus: { emoji: '🦠', name: 'Virus', color: '#ef4444' },
            bacteria: { emoji: '🧫', name: 'Bactérie', color: '#f59e0b' },
            fungus: { emoji: '🍄', name: 'Champignon', color: '#8b5cf6' },
            parasite: { emoji: '🐛', name: 'Parasite', color: '#f97316' },
            hypertension: { emoji: '💓', name: 'Hypertension', color: '#dc2626' },
            diabetes: { emoji: '🍯', name: 'Diabète', color: '#059669' },
            safe: { emoji: '✅', name: 'Zone Sûre', color: '#10b981' },
            bonus: { emoji: '⭐', name: 'Case Bonus', color: '#fbbf24' },
            challenge: { emoji: '🎯', name: 'Défi Médical', color: '#ec4899' },
            start: { emoji: '🏁', name: 'Départ', color: '#3b82f6' },
            finish: { emoji: '🏆', name: 'Arrivée', color: '#fbbf24' }
        };

        const cardData = {
            antiviral: { name: 'Antiviraux', icon: '💊', target: 'virus' },
            antibiotic: { name: 'Antibiotiques', icon: '💉', target: 'bacteria' },
            antifungal: { name: 'Antifongiques', icon: '🧪', target: 'fungus' },
            antiparasitic: { name: 'Antiparasitaires', icon: '⚗️', target: 'parasite' },
            antihypertensive: { name: 'Antihypertenseurs', icon: '💗', target: 'hypertension' },
            antidiabetic: { name: 'Antidiabétiques', icon: '🩺', target: 'diabetes' }
        };

        function switchScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            appState.currentScreen = screenId;
        }



        // Fonctions de jeu (reprises et améliorées)
        function initGame() {
            createBoard();
            updateUI();
            showMessage("🎮 Plateau étendu à 60 cases ! Découvrez les nouvelles cases Bonus ⭐ et Défi 🎯 ! Cartes illimitées disponibles !", "success");
            playSound('gameStart');
        }

        function createBoard() {
            const board = document.getElementById('gameBoard');
            board.innerHTML = '';

            boardConfig.forEach((cellType, index) => {
                const cell = document.createElement('div');
                const pathogen = pathogenData[cellType];
                
                cell.className = `cell ${cellType}`;
                cell.id = `cell-${index}`;
                cell.innerHTML = `
                    <div class="cell-emoji">${pathogen.emoji}</div>
                    <div class="cell-number">${index}</div>
                `;
                
                board.appendChild(cell);
            });

            updatePlayerPositions();
        }

        function updatePlayerPositions() {
            document.querySelectorAll('.player').forEach(p => p.remove());

            Object.keys(gameState.players).forEach(playerId => {
                const position = gameState.players[playerId].position;
                const cell = document.getElementById(`cell-${position}`);
                if (cell) {
                    const player = document.createElement('div');
                    player.className = `player player${playerId}`;
                    cell.appendChild(player);
                }
            });
        }

        function rollDice() {
            if (gameState.gameEnded) return;
            
            const currentPlayerData = gameState.players[gameState.currentPlayer];
            
            if (currentPlayerData.needsDefense) {
                showMessage("⚠️ Vous devez d'abord traiter l'infection avant de continuer !", "danger");
                return;
            }

            const diceEl = document.getElementById('dice');
            diceEl.classList.add('rolling');
            
            let rollCount = 0;
            const rollInterval = setInterval(() => {
                const tempValue = Math.floor(Math.random() * 6) + 1;
                diceEl.querySelector('span').textContent = tempValue;
                rollCount++;
                
                if (rollCount >= 12) {
                    clearInterval(rollInterval);
                    const finalValue = Math.floor(Math.random() * 6) + 1;
                    gameState.diceValue = finalValue;
                    diceEl.querySelector('span').textContent = finalValue;
                    diceEl.classList.remove('rolling');
                    
                    playSound('diceRoll');
                    movePlayer(gameState.currentPlayer, finalValue);
                }
            }, 120);
        }

        function movePlayer(playerId, steps) {
            const player = gameState.players[playerId];
            let currentStep = 0;
            
            const moveInterval = setInterval(() => {
                if (currentStep < steps && player.position < boardConfig.length - 1) {
                    player.position++;
                    updatePlayerPositions();
                    
                    // Animation du joueur
                    const playerEl = document.querySelector(`.player${playerId}`);
                    if (playerEl) {
                        playerEl.classList.add('moving');
                        setTimeout(() => playerEl.classList.remove('moving'), 600);
                    }
                    
                    playSound('move');
                    currentStep++;
                } else {
                    clearInterval(moveInterval);
                    checkCellEffect(playerId, player.position);
                }
            }, 400);
        }

        function checkCellEffect(playerId, position) {
            const player = gameState.players[playerId];
            const cellType = boardConfig[position];
            const pathogen = pathogenData[cellType];
            
            if (cellType === 'finish') {
                endGame(playerId);
                return;
            }
            
            if (['virus', 'bacteria', 'fungus', 'parasite', 'hypertension', 'diabetes'].includes(cellType)) {
                player.needsDefense = true;
                player.threatType = cellType;
                
                showMessage(`🚨 INFECTION DÉTECTÉE ! Vous avez contracté un ${pathogen.name} ! Sélectionnez le traitement approprié immédiatement !`, "danger");
                
                const cell = document.getElementById(`cell-${position}`);
                cell.style.animation = 'pulse-danger 0.8s ease-in-out 4';
                
                document.getElementById('useCardBtn').disabled = false;
                document.getElementById('skipBtn').disabled = false;
                
                playSound('infection');
            } else if (cellType === 'bonus') {
                // Case bonus - gain de points et relance
                const bonusPoints = Math.floor(Math.random() * 50) + 50; // 50-100 points
                player.score += bonusPoints;
                
                showMessage(`⭐ CASE BONUS ! ${player.name} gagne ${bonusPoints} points et peut relancer le dé !`, "success");
                
                const cell = document.getElementById(`cell-${position}`);
                cell.style.animation = 'pulse-bonus 1s ease-in-out 3';
                
                playSound('bonus');
                // Le joueur garde son tour
            } else if (cellType === 'challenge') {
                // Case défi - question médicale complexe
                const challenges = [
                    { question: "Quel est l'antidote de l'intoxication au paracétamol ?", answer: "N-acétylcystéine", points: 100 },
                    { question: "Quelle est la dose maximale de paracétamol par jour ?", answer: "4g", points: 80 },
                    { question: "Quel antibiotique est contre-indiqué chez l'enfant ?", answer: "Tétracycline", points: 90 },
                    { question: "Quel est le mécanisme d'action de l'aspirine ?", answer: "Inhibition COX", points: 85 }
                ];
                
                const challenge = challenges[Math.floor(Math.random() * challenges.length)];
                
                showMessage(`🎯 DÉFI MÉDICAL ! Question bonus : "${challenge.question}" - Répondez correctement pour gagner ${challenge.points} points !`, "");
                
                const cell = document.getElementById(`cell-${position}`);
                cell.style.animation = 'pulse-challenge 1s ease-in-out 3';
                
                // Simulation d'une réponse (50% de chance de réussir)
                setTimeout(() => {
                    if (Math.random() > 0.5) {
                        player.score += challenge.points;
                        showMessage(`🎉 EXCELLENT ! Bonne réponse ! +${challenge.points} points !`, "success");
                        playSound('success');
                    } else {
                        showMessage(`❌ Dommage ! La bonne réponse était : ${challenge.answer}`, "danger");
                        playSound('failure');
                    }
                    nextTurn();
                }, 3000);
                
                playSound('challenge');
                return; // Ne pas passer au tour suivant immédiatement
            } else {
                // Case sûre
                showMessage(`✅ Zone sécurisée ! ${player.name} peut continuer en toute sécurité.`, "success");
                player.score += 15;
                nextTurn();
                playSound('safe');
            }
            
            updateUI();
        }

        function selectCard(cardType) {
            if (gameState.gameEnded) return;
            
            const currentPlayerData = gameState.players[gameState.currentPlayer];
            if (!currentPlayerData.needsDefense) {
                showMessage("💡 Aucune infection active. Pas besoin de traitement pour le moment !", "");
                return;
            }
            
            document.querySelectorAll('.defense-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            event.target.closest('.defense-card').classList.add('selected');
            gameState.selectedCard = cardType;
            
            document.getElementById('useCardBtn').disabled = false;
            playSound('cardSelect');
            
            const card = cardData[cardType];
            showMessage(`🎯 ${card.name} sélectionné ! Cliquez sur "Utiliser Traitement" pour l'administrer.`, "");
        }

        function useDefenseCard() {
            const currentPlayerData = gameState.players[gameState.currentPlayer];
            
            if (!currentPlayerData.needsDefense || !gameState.selectedCard) {
                showMessage("❌ Aucun traitement sélectionné ou aucune infection active !", "danger");
                return;
            }



            const correctCard = {
                virus: 'antiviral',
                bacteria: 'antibiotic',
                fungus: 'antifungal',
                parasite: 'antiparasitic',
                hypertension: 'antihypertensive',
                diabetes: 'antidiabetic'
            };

            const isCorrectTreatment = correctCard[currentPlayerData.threatType] === gameState.selectedCard;
            const pathogen = pathogenData[currentPlayerData.threatType];
            const card = cardData[gameState.selectedCard];

            if (isCorrectTreatment) {
                currentPlayerData.needsDefense = false;
                currentPlayerData.threatType = null;
                currentPlayerData.score += 75;
                
                showMessage(`🎉 TRAITEMENT RÉUSSI ! ${card.name} parfaitement efficace contre ${pathogen.name} ! Infection éradiquée !`, "success");
                playSound('success');
                
                const cell = document.getElementById(`cell-${currentPlayerData.position}`);
                cell.style.animation = 'glow-gold 1s ease-in-out 3';
                
                nextTurn();
            } else {
                currentPlayerData.score = Math.max(0, currentPlayerData.score - 30);
                
                showMessage(`❌ ERREUR THÉRAPEUTIQUE ! ${card.name} inefficace contre ${pathogen.name} ! Recul de ${gameRules.penaltyForWrongTreatment} cases !`, "danger");
                playSound('failure');
                
                currentPlayerData.position = Math.max(0, currentPlayerData.position - gameRules.penaltyForWrongTreatment);
                currentPlayerData.needsDefense = false;
                currentPlayerData.threatType = null;
                
                updatePlayerPositions();
                nextTurn();
            }

            resetCardSelection();
            updateUI();
        }

        function skipTurn() {
            const currentPlayerData = gameState.players[gameState.currentPlayer];
            
            if (currentPlayerData.needsDefense) {
                // Nouvelle règle : seulement passer le tour sans pénalité
                currentPlayerData.needsDefense = false;
                currentPlayerData.threatType = null;
                
                showMessage(`⏭️ TOUR PASSÉ ! ${currentPlayerData.name} ne peut pas répondre et passe son tour.`, "");
                playSound('skip');
            }
            
            resetCardSelection();
            nextTurn();
        }

        function resetCardSelection() {
            gameState.selectedCard = null;
            document.querySelectorAll('.defense-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.getElementById('useCardBtn').disabled = true;
            document.getElementById('skipBtn').disabled = true;
        }

        function nextTurn() {
            gameState.currentPlayer = gameState.currentPlayer === 1 ? 2 : 1;
            if (gameState.currentPlayer === 1) {
                gameState.turnNumber++;
            }
            updateUI();
            
            const currentPlayer = gameState.players[gameState.currentPlayer];
            showMessage(`🔄 Tour de ${currentPlayer.name} ! Lancez le dé pour continuer.`, "");
        }

        function updateUI() {
            Object.keys(gameState.players).forEach(playerId => {
                const player = gameState.players[playerId];
                document.getElementById(`player${playerId}Pos`).textContent = player.position;
                document.getElementById(`player${playerId}Score`).textContent = player.score;
                
                const progress = (player.position / (gameState.totalCells - 1)) * 100;
                document.getElementById(`player${playerId}Progress`).style.width = `${progress}%`;
            });
            
            const currentPlayer = gameState.players[gameState.currentPlayer];
            document.getElementById('currentPlayer').textContent = currentPlayer.name;
            
            document.getElementById('player1Info').classList.toggle('active', gameState.currentPlayer === 1);
            document.getElementById('player2Info').classList.toggle('active', gameState.currentPlayer === 2);
            
            document.getElementById('turnCounter').textContent = gameState.turnNumber;
        }

        function showMessage(text, type = '') {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = `message ${type}`;
            messageEl.style.display = 'block';
            
            messageEl.style.animation = 'messageSlide 0.6s ease-out';
            
            // Les messages restent visibles jusqu'au prochain message
        }

        function endGame(winnerId) {
            gameState.gameEnded = true;
            const winner = gameState.players[winnerId];
            
            showMessage(`🏆 VICTOIRE ÉCLATANTE ! ${winner.name} remporte la partie avec ${winner.score} points ! Félicitations pour cette performance exceptionnelle !`, "success");
            playSound('victory');
            
            const winnerInfo = document.getElementById(`player${winnerId}Info`);
            winnerInfo.style.animation = 'bounce 0.8s ease-in-out infinite';
            
            document.getElementById('useCardBtn').disabled = true;
            document.getElementById('skipBtn').disabled = true;
            
            // Effet de célébration
            document.body.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%), radial-gradient(circle, gold 3px, transparent 3px)';
            document.body.style.backgroundSize = '400% 400%, 60px 60px';
        }

        function resetGame() {
            gameState = {
                currentPlayer: 1,
                players: {
                    1: { 
                        position: 0, 
                        needsDefense: false, 
                        threatType: null,
                        name: gameState.players[1].name,
                        avatar: "👨‍⚕️",
                        score: 0,
                        isOnline: true
                    },
                    2: { 
                        position: 0, 
                        needsDefense: false, 
                        threatType: null,
                        name: gameState.players[2].name,
                        avatar: "👩‍⚕️",
                        score: 0,
                        isOnline: gameState.players[2].isOnline
                    }
                },
                selectedCard: null,
                diceValue: 0,
                gameEnded: false,
                totalCells: 60,
                gameCode: gameState.gameCode
            };
            
            document.getElementById('dice').querySelector('span').textContent = '🎲';
            document.body.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%)';
            document.body.style.backgroundSize = '400% 400%';
            
            document.querySelectorAll('.player-info').forEach(info => {
                info.style.animation = '';
            });
            
            resetCardSelection();
            updatePlayerPositions();
            updateUI();
            showMessage("🎮 Nouvelle partie lancée ! Prêts pour un nouveau défi médical ?", "success");
            playSound('gameStart');
        }

        // Simulation des effets sonores
        const playSound = (type) => {
            const sounds = {
                gameStart: '🎵 Musique d\'intro',
                diceRoll: '🎲 Bruit de dé',
                move: '👣 Pas de déplacement',
                infection: '🚨 Alerte infection',
                safe: '✅ Zone sûre',
                cardSelect: '🃏 Sélection carte',
                success: '🎉 Succès',
                failure: '❌ Échec',
                penalty: '⚠️ Pénalité',
                skip: '⏭️ Tour passé',
                victory: '🏆 Victoire',
                bonus: '⭐ Son bonus',
                challenge: '🎯 Son défi'
            };
            console.log(`🔊 ${sounds[type] || type}`);
        };

        // Raccourcis clavier améliorés
        document.addEventListener('keydown', (e) => {
            if (appState.currentScreen !== 'gameScreen' || gameState.gameEnded) return;
            
            switch(e.key) {
                case ' ':
                    e.preventDefault();
                    rollDice();
                    break;
                case '1':
                    selectCard('antiviral');
                    break;
                case '2':
                    selectCard('antibiotic');
                    break;
                case '3':
                    selectCard('antifungal');
                    break;
                case '4':
                    selectCard('antiparasitic');
                    break;
                case 'Enter':
                    if (!document.getElementById('useCardBtn').disabled) {
                        useDefenseCard();
                    }
                    break;
                case 'Escape':
                    if (!document.getElementById('skipBtn').disabled) {
                        skipTurn();
                    }
                    break;
            }
        });

        // Initialisation
        window.onload = function() {
            initGame();
        };
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9701d4bbc0cc7784',t:'MTc1NTM1NjczOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
